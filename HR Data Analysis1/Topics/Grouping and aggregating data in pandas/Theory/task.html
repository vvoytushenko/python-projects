<h2>Grouping and aggregating data in pandas</h2>
<p><strong>Aggregation</strong> is very important for data analysis. We use it when we need to provide an assessment of our dataset values. By performing aggregation, we transform our data into information.</p>
<p>In this topic, we are going to use the Palmer Penguins dataset as an example. You can import it from GitHub using the following lines (internet connection required):</p>
<p> </p>
<pre><code class="language-python">import pandas as pd
df = pd.read_csv(
'https://raw.githubusercontent.com/mwaskom/seaborn-data/master/penguins.csv')</code></pre>
<p>The title of each column speaks for itself:</p>
<pre><code class="language-python">df.head(3)</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight"> 	species    island 	bill_length_mm 	bill_depth_mm 	flipper_length_mm 	body_mass_g 	sex
0 	Adelie 	Torgersen 	          39.1 	         18.7 	            181.0 	     3750.0    MALE
1 	Adelie 	Torgersen 	          39.5 	         17.4 	            186.0 	     3800.0  FEMALE
2 	Adelie 	Torgersen 	          40.3 	         18.0 	            195.0 	     3250.0  FEMALE</code></pre>
<p style="text-align: center;"><img alt="" height="162" name="logo.png" src="https://ucarecdn.com/6085b854-f507-41f2-80bd-493b4b33ad86/" width="140"/></p>
<h5 id="dataframeaggregate">DataFrame.aggregate</h5>
<p><code class="language-python">aggregate()</code><strong> </strong>is a <code class="language-python">pandas</code> DataFrame and Series method that is used for data aggregation. It can be used for one or many functions along any axis. To save some time for Really Important Things (like Machine Learning or Netflix), you may want to use the shorter version of the method — <code class="language-python">agg()</code>. Let's have a look at the following examples.</p>
<p>Suppose we want to find the median value of the penguin's body mass. You can do it by applying the <code class="language-python">agg()</code> method to the desired series:</p>
<pre><code class="language-python">df.body_mass_g.agg('median')</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">4050.0</code></pre>
<p>Four kilos of black-and-white antarctic cuteness!</p>
<p><button class="btn-sm btn-outline-secondary" onclick="getElementById('hint-2064').style.display='inline'">
        Hint
      </button>
</p><div id="hint-2064" style="display:none;"> You can pass a function, the function name(as a string), a list of functions(or their names) or a <code class="language-python">dict</code> to <code class="language-python">.agg()</code>, for example, <code class="language-python">'unique'</code>in <code class="language-python">df.body_mass_g.agg('unique')</code> will get the unique elements from <code class="language-python">body_mass_g</code> column, <code class="language-python">'nunique'</code> will count the unique elements in the specified column, and <code class="language-python">'sum'</code> in <code class="language-python">df.body_mass_g.agg('sum')</code>will produce the sum of <code class="language-python">body_mass_g</code> values.

<p>Also, you can pass a function like so(here we pass a Python built-in <code class="language-python">sum()</code>, but any function that handles a <code class="language-python">DataFrame</code> can be passed):</p>
<pre><code class="language-python">df.body_mass_g.agg(sum)</code></pre>
<p>We also could import <code class="language-python">numpy</code>, run <code class="language-python">df.body_mass_g.agg(numpy.sum)</code> and obtain the same result.</p>
<p></p></div>
<p>Another way to do it is by calling the <code class="language-python">median()</code> method from the Series:</p>
<pre><code class="language-python">df.body_mass_g.median()</code></pre>
<p>The difference is that by using the <code class="language-python">agg()</code> function, we are also able to apply several aggregating functions to different columns. For example, let's find the shortest and the average penguin bill as well as the longest and the average flipper. To do this, we need to call <code class="language-python">agg()</code> and create a Python dictionary using the columns as dictionary keys. Also, we need to put the aggregating functions in lists:</p>
<pre><code class="language-python">df.agg({'bill_length_mm': ['min', 'mean'],
         'flipper_length_mm': ['max', 'mean']
        })</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight"> 	bill_length_mm 	flipper_length_mm
 min 	  32.10000 	              NaN
mean 	  43.92193 	       200.915205
 max 	       NaN 	       231.000000</code></pre>
<p><button class="btn-sm btn-outline-secondary" onclick="getElementById('hint-3914').style.display='inline'">
        Hint
      </button>
</p><div id="hint-3914" style="display:none;">The function outputs <code class="language-python">NaN</code> for the values we have not specified.</div>
<p>It's also possible to aggregate the data with your own functions. The example of the function below outputs the number of missing values. If the set contains no such values, it puts <code class="language-python">0</code> (by default):</p>
<pre><code class="language-python">def count_nulls(series, ok_message=0):
    if not series.isna().sum():
        return ok_message
    return len(series) - series.count()</code></pre>
<p>Let's use it in our DataFrame:</p>
<pre><code class="language-python">df.agg(count_nulls)</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">species               0
island                0
bill_length_mm        2
bill_depth_mm         2
flipper_length_mm     2
body_mass_g           2
sex                  11
dtype: int64</code></pre>
<p>If you need to pass a parameter to the <code class="language-python">agg()</code> function, just list their names and values separated by a comma after the function name:</p>
<pre><code class="language-python">df.agg(count_nulls, ok_message='Hurray!')</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">species              Hurray!
island               Hurray!
bill_length_mm             2
bill_depth_mm              2
flipper_length_mm          2
body_mass_g                2
sex                       11
dtype: object</code></pre>
<p><button class="btn-sm btn-outline-secondary" onclick="getElementById('hint-5310').style.display='inline'">
        Hint
      </button>
</p><div id="hint-5310" style="display:none;">If you use non-<code class="language-python">pandas</code> functions (<code class="language-python">NumPy</code> or your own) — don't put their names in quotes.</div>
<p>If you want to find the biggest value out of a specific set of features for each penguin(suppose we want to look at the biggest value out of 3 features — <code class="language-python">bill_length_mm</code>, <code class="language-python">bill_depth_mm</code>, and <code class="language-python">flipper_length_mm</code>), apply <code class="language-python">agg()</code> over the columns by setting the <code class="language-python">axis</code> argument to <code class="language-python">'<span style="color: #000000;">columns'</span></code>. We can also call the <code class="language-python">agg()</code> method to slice the data frame that contains only numeric values. Let's use the Python built-in <code class="language-python">max()</code> function. It results in a <code class="language-python">pandas</code> Series:</p>
<pre><code class="language-python">df[['bill_length_mm', 'bill_depth_mm', 'flipper_length_mm']].agg(max, 
axis='columns')</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">0      181.0
1      186.0
2      195.0
3        NaN
4      193.0
       ...  
339      NaN
340    215.0
341    222.0
342    212.0
343    213.0
Length: 344, dtype: float64</code></pre>
<h5 id="dataframegroupby">DataFrame.groupby</h5>
<p>We can get a statistical output from different columns with aggregation, but to understand the data deeper, we need to have a closer look at various slices and combinations of columns. For this purpose, we can use <code class="language-python">groupby()</code>. It's a very simple tool, especially for those who are already familiar with SQL.</p>
<p>Now let's check the median bill length for females and males. Group all penguins by their sex and aggregate them with one line:</p>
<pre><code class="language-python">df.groupby(['sex']).agg({'bill_length_mm':'median'})</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">       bill_length_mm
   sex 	
FEMALE 	         42.8
  MALE 	         46.8</code></pre>
<p> </p>
<p>The <code class="language-python">df.groupby(['sex'])</code> alone outputs something like "&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x000002A1E7BE8358&gt;". That's because it's just an object in memory with split values for indicated groups. The interpreter doesn't know what to output unless you directly specify it with <code class="language-python">agg()</code>. </p>
<p>As you've noticed, the "sex" column contains 11 missing values (some penguins preferred not to share their gender). To include them in our grouping, set the <code class="language-python">groupby</code> <code class="language-python">dropna</code> argument to <code class="language-python">False</code> (<code class="language-python">pandas</code> 1.1 or higher required):</p>
<pre><code class="language-python">df.groupby('sex', dropna=False).agg({'bill_length_mm':'median'})</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">       bill_length_mm
   sex 	
FEMALE 	         42.8
  MALE 	         46.8
   NaN 	         42.0</code></pre>
<p>Now we can assume that penguins of unknown sex are mostly females.</p>
<p>Next, let's suppose that the penguin's diet varies by island, and it affects the bill length. To check whether it makes sense or not, group our antarctic friends by island and sex. Keep in mind that when we need to pass several arguments, we need to pass a list:</p>
<pre><code class="language-python">df.groupby(['island', 'sex']).agg({'bill_length_mm':'median'})</code></pre>
<p>Output:</p>
<pre><code class="language-no-highlight">                  bill_length_mm
island    sex                   
Biscoe    FEMALE            44.9
          MALE              48.5
Dream     FEMALE            42.5
          MALE              49.1
Torgersen FEMALE            37.6
          MALE              41.1</code></pre>
<p>The argument order in the <code class="language-python">groupby()</code> argument list determines the grouping order. Groups come first, then subgroups, subgroups of subgroups, and so on.</p>
<p><button class="btn-sm btn-outline-secondary" onclick="getElementById('hint-9059').style.display='inline'">
        Hint
      </button>
</p><div id="hint-9059" style="display:none;"> As you've seen thus far, <code class="language-python">groupby</code>will make the group labels you pass into it into index columns — the <code class="language-python">as_index</code> parameter is responsible for that, and is set to <code class="language-python">True</code> by default.  For our last example, if we call <code class="language-python">.index.names</code>, we can see that we have 2 indexes — <code class="language-python">'island'</code> and <code class="language-python">'sex'</code>:

<pre><code class="language-python">df.groupby(['island', 'sex']).agg({'bill_length_mm':'median'}).index.names</code></pre>
<p>The output will look like this: <code class="language-python">FrozenList(['island', 'sex'])</code></p>
<p>In case you want to avoid setting the index(es) to the group labels passed into <code class="language-python">.groupby</code>, you have to set <code class="language-python">as_index</code> to <code class="language-python">False</code>:</p>
<pre><code class="language-python">df.groupby(['island', 'sex'], as_index = False).agg({'bill_length_mm':'median'})</code></pre>
<p></p></div>
<h5 id="conclusion">Conclusion</h5>
<p>In this topic, you have learned how to:</p>
<ul>
<li>calculate the column summary statistics with the help of <code class="language-python">agg()</code></li>
<li>separate dataset into groups with the help of <code class="language-python">groupby()</code>.</li>
</ul>
<p>These <code class="language-python">pandas</code> functions can help you find outliers in the data, evaluate a series of observations and compare groups against the desired statistical feature.</p>
<p>Nevertheless, bear in mind the possible result, when you conduct a complicated aggregation and grouping of real data. One diagram drawn on paper can save hours of fixing the code. If you keep getting errors and wrong answers, it probably has nothing to do with Python usage — your logic might be faulty.</p>
